generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// MongoDB automatically indexes id and prisma @id maps to it so no need to index
model User {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  email        String    @unique
  passwordHash String
  createdAt    DateTime  @default(now())
  ownedSecrets Secret[]  @relation("UserSecrets")
  sessions     Session[]
}

model Secret {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  encryptedText String
  encryptionIV  String
  receiverEmail String?
  creatorId     String    @db.ObjectId
  creator       User      @relation("UserSecrets", fields: [creatorId], references: [id])
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  expiresAt     DateTime
  viewedAt      DateTime?

  // @@index([expiresAt], map: "expiresAt_ttl") // MongoDB will auto-delete after this date
  @@index([creatorId])
}

model Session {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  tokenHash String   @unique
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  expiresAt DateTime

  // @@index([expiresAt], map: "expiresAt_ttl") // Cleans up old sessions automatically
  @@index([userId])
  @@index([expiresAt])
}

//npx prisma generate
// npx prisma db push to sync to mongodb database
