import { useMemo } from "react";
import { formatDate } from "../../utils/time/formatDate";
import TimelineElement from "./TimelineElement";
import { getTimePercentage } from "../../utils/time/getTimePercentage";
import { calcTimeRemaining } from "../../utils/time/calcTimeRemaining";

const Timeline = ({
  secret,
}: {
  secret: {
    createdAt: string;
    expiresAt: string;
    viewedAt: string;
    status: string;
  };
}) => {
  const timePassedPercent = useMemo(() => {
    if (!secret) return "0";
    return getTimePercentage(secret.createdAt, secret.expiresAt);
  }, [secret]);
  const timeRemaining = useMemo(() => {
    if (!secret) return "";
    return calcTimeRemaining(secret.expiresAt);
  }, [secret]);

  return (
    <div className="flex flex-col gap-2 ml-5 my-20">
      <div className="flex items-center gap-2 mb-2">
        <svg
          viewBox="0 0 16 16"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          id="History--Streamline-Unicons"
          height="16"
          width="16"
        >
          <desc>History Streamline Icon: https://streamlinehq.com</desc>
          <path
            d="M8 0.15999999999999998C5.9901333333333335 0.16573333333333332 4.0592 0.9431333333333334 2.6060666666666665 2.3316666666666666V0.944c0 -0.20793333333333333 -0.08259999999999999 -0.4073333333333333 -0.22959999999999997 -0.5544C2.2294 0.24259999999999998 2.03 0.15999999999999998 1.8220666666666665 0.15999999999999998s-0.4073333333333333 0.08259999999999999 -0.5543333333333333 0.22959999999999997c-0.14706666666666665 0.14706666666666665 -0.22966666666666663 0.3464666666666667 -0.22966666666666663 0.5544v3.5279999999999996c0 0.20793333333333333 0.08259999999999999 0.4073333333333333 0.22966666666666663 0.5544 0.147 0.147 0.34639999999999993 0.22959999999999997 0.5543333333333333 0.22959999999999997h3.5279999999999996c0.20793333333333333 0 0.4073333333333333 -0.08259999999999999 0.5544 -0.22959999999999997 0.147 -0.14706666666666665 0.22959999999999997 -0.3464666666666667 0.22959999999999997 -0.5544s-0.08259999999999999 -0.4073333333333333 -0.22959999999999997 -0.5544c-0.14706666666666665 -0.147 -0.3464666666666667 -0.22959999999999997 -0.5544 -0.22959999999999997H3.4684666666666666c1.0080666666666667 -1.0534 2.3516 -1.7227333333333332 3.799666666666666 -1.8928666666666667 1.4481333333333333 -0.17006666666666664 2.9102 0.1696 4.134933333333333 0.9607333333333333 1.2247333333333332 0.7910666666666667 2.135533333333333 1.9842 2.5759333333333334 3.3741333333333334 0.44039999999999996 1.3899333333333335 0.38273333333333337 2.889866666666667 -0.16299999999999998 4.241866666666667s-1.5453999999999999 2.471733333333333 -2.8272666666666666 3.1665333333333328c-1.2818 0.6948 -2.7656666666666667 0.9212666666666666 -4.1964 0.6405333333333333 -1.4307999999999998 -0.2808 -2.719 -1.0512 -3.6432666666666664 -2.1788C2.2248666666666663 10.872399999999999 1.7223333333333333 9.457999999999998 1.728 8c0 -0.20793333333333333 -0.08259999999999999 -0.4074 -0.22959999999999997 -0.5544 -0.14706666666666665 -0.147 -0.3464666666666667 -0.22959999999999997 -0.5544 -0.22959999999999997s-0.4073333333333333 0.08259999999999999 -0.5544 0.22959999999999997C0.24259999999999998 7.592599999999999 0.15999999999999998 7.792066666666667 0.15999999999999998 8c0 1.5505999999999998 0.4598 3.0664 1.3212666666666666 4.355666666666666 0.8614666666666666 1.2892666666666666 2.085933333333333 2.294133333333333 3.518466666666667 2.887533333333333 1.4325999999999999 0.5933999999999999 3.0089333333333332 0.7486666666666666 4.529733333333333 0.4462 1.5208 -0.3026 2.917733333333333 -1.0492666666666666 4.014266666666666 -2.1456666666666666 1.0964 -1.0965333333333334 1.8431333333333333 -2.4934666666666665 2.1456666666666666 -4.014266666666666 0.30246666666666666 -1.5208 0.1472 -3.097133333333333 -0.4462 -4.529733333333333 -0.5933999999999999 -1.4325333333333332 -1.5982666666666667 -2.657 -2.887533333333333 -3.518466666666667C11.066399999999998 0.6197999999999999 9.5506 0.15999999999999998 8 0.15999999999999998Zm0 4.704c-0.20793333333333333 0 -0.4074 0.08259999999999999 -0.5544 0.22959999999999997 -0.147 0.14706666666666665 -0.22959999999999997 0.3464666666666667 -0.22959999999999997 0.5544V8c0 0.20793333333333333 0.08259999999999999 0.4073333333333333 0.22959999999999997 0.5543333333333333s0.3464666666666667 0.22966666666666663 0.5544 0.22966666666666663h1.5679999999999998c0.20793333333333333 0 0.4073333333333333 -0.08266666666666667 0.5543333333333333 -0.22966666666666663s0.22966666666666663 -0.34639999999999993 0.22966666666666663 -0.5543333333333333c0 -0.20793333333333333 -0.08266666666666667 -0.4074 -0.22966666666666663 -0.5544s-0.34639999999999993 -0.22959999999999997 -0.5543333333333333 -0.22959999999999997h-0.7839999999999999V5.648c0 -0.20793333333333333 -0.08266666666666667 -0.4073333333333333 -0.22966666666666663 -0.5544 -0.147 -0.147 -0.34639999999999993 -0.22959999999999997 -0.5543333333333333 -0.22959999999999997Z"
            fill="#eee"
            strokeWidth="0.6667"
          ></path>
        </svg>
        <h1 className="electrolize">Timeline</h1>
      </div>
      {/* NEW */}
      <>
        <TimelineElement
          timelinePoint="created"
          time={formatDate(secret.createdAt)}
          faded
        />
        {secret.status !== "EXPIRED" && (
          <TimelineElement
            timelinePoint={
              secret.status === "VIEWED" ? "wouldExpire" : "expires"
            }
            time={formatDate(secret.expiresAt)}
            timePassedPercent={timePassedPercent}
            dashed
            faded={secret.status !== "ACTIVE"}
            extraInfo={timeRemaining}
          />
        )}
        {secret.status === "VIEWED" && (
          <TimelineElement
            timelinePoint="viewed"
            time={formatDate(secret.viewedAt)}
            dashed
            extraInfo="Erased"
          />
        )}
        {secret.status === "EXPIRED" && (
          <TimelineElement
            timelinePoint="expired"
            time={formatDate(secret.expiresAt)}
            dashed
          />
        )}
      </>
    </div>
  );
};

export default Timeline;
